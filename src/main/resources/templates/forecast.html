<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>
<div th:replace="fragments/header :: body"></div>

<div class="container mt-4">
    <h2 class="text-center mb-4">Currency Forecast</h2>

    <!-- Форма -->
    <form class="row g-3 mb-5" method="post" th:action="@{/forecast}" th:object="${request}">
        <div class="col-md-3">
            <label for="currency" class="form-label">Currency</label>
            <select id="currency" class="form-select" th:field="*{currency}">
                <option th:each="c : ${currencies}" th:value="${c}" th:text="${c}"></option>
            </select>
        </div>

        <div class="col-md-3">
            <label for="startDate" class="form-label">Start Date</label>
            <input type="date" id="startDate" class="form-control" th:field="*{startDate}" required>
        </div>

        <div class="col-md-3">
            <label for="days" class="form-label">Forecast Days</label>
            <input type="number" id="days" class="form-control" th:field="*{days}" min="1" required>
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Forecast</button>
        </div>
    </form>

    <!-- График -->
    <div th:if="${predictedRates != null && !predictedRates.isEmpty()}">
        <h4 class="text-center mt-4" th:text="'Forecast for ' + ${currency} + ' (' + ${start} + ' - ' + ${end} + ')'"></h4>
        <canvas id="forecastChart" width="900" height="450"></canvas>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script th:inline="javascript">
            /*<![CDATA[*/
            const historyLabels = [[${historyLabels}]];
            const historyData = [[${historyRates}]];
            const forecastLabels = [[${predictedLabels}]];
            const forecastData = [[${predictedRates}]];

            const ctx = document.getElementById('forecastChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historyLabels.concat(forecastLabels),
                    datasets: [
                        {
                            label: 'Historical Rates',
                            data: historyData,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.3
                        },
                        {
                            label: 'Forecasted Rates',
                            data: new Array(historyData.length).fill(null).concat(forecastData),
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderDash: [5, 5],
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Exchange Rate Forecast'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
            /*]]>*/
        </script>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>